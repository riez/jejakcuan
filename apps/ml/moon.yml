$schema: 'https://moonrepo.dev/schemas/project.json'
language: 'python'
type: 'application'
stack: 'backend'
tags:
  - 'python'
  - 'ml'

tasks:
  dev:
    command: 'cd src && uvicorn jejakcuan_ml.main:app --reload --host 0.0.0.0 --port 8000'
    options:
      persistent: true

  test:
    command: 'pytest'
    inputs:
      - 'src/**/*'
      - 'tests/**/*'

  lint:
    command: 'ruff check src tests'
    inputs:
      - 'src/**/*'
      - 'tests/**/*'

  fmt:
    command: 'ruff format --check src tests'
    inputs:
      - 'src/**/*'
      - 'tests/**/*'

  typecheck:
    command: 'mypy src'
    inputs:
      - 'src/**/*'

  scrape:
    command: 'cd src && python -m jejakcuan_ml.scrapers.cli'
    options:
      persistent: false

  scrape-all:
    command: 'cd src && python -m jejakcuan_ml.scrapers.cli all --days 60'
    options:
      persistent: false

  scrape-price:
    command: 'cd src && python -m jejakcuan_ml.scrapers.cli price --days 365'
    options:
      persistent: false

  scrape-broker:
    command: 'cd src && python -m jejakcuan_ml.scrapers.cli broker --days 30'
    options:
      persistent: false
